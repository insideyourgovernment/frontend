"    function numberWithCommas(x) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n    function cell(value2, value3) {\n        table_html = '';\nif (!(value3 in value2)) {\n        table_html += '<td></td>';\n      } else if (value3.indexOf(\"photo\") > -1) {\n        table_html += '<td class=\"photo\"><img src=\"'+value2[value3]+'\" style=\"max-width:100px\" /></td>';\n      } else if (value2[value3] === parseInt(value2[value3], 10)) {\n        table_html += '<td>'+numberWithCommas(value2[value3])+'</td>';\n      } else if (value3 == 'links') {\n        table_html += '<td><ul>';\n        $.each(value2[value3], function(linki, link) {\n          table_html += '<li><a href=\"'+link['url']+'\">'+link['name']+'</a></li>';\n        });\n        table_html += '</ul></td>';\n      } else if (value3.indexOf('link') > -1) {\n        table_html += '<td><a href=\"'+value2[value3]+'\">'+value2[value3]+'</a></td>';\n      } else if (value3 == 'Summarized results') {\n        var sresults = value2[value3];\n        table_html += '<td><table>';\n        $.each(sresults, function(eindex, employee) {\n          table_html += '<tr><th colspan=\"2\">'+employee['heading']+'</th></tr>';\n          $.each(employee['allegations'], function(aindex, allegation) {\n            table_html += '<tr><th>'+allegation['heading']+'</th><td>'+allegation['allegation']+'</td></tr>';\n            if (stringStartsWith(allegation['opa_finding'], 'Sustained')) {\n              highlighting = ' class=\"highlight\"';\n            } else {\n              highlighting = '';\n            }\n            table_html += '<tr><th>'+allegation['heading']+' OPA finding</th><td'+highlighting+'>'+allegation['opa_finding']+'</td></tr>';\n          });\n          table_html += '<tr><th>Final discipline</th><td>'+employee['final_discipline']+'</td></tr>';\n        });\n        table_html += '</table>';\n        table_html += '</td>';\n      } else if (String(value2[value3]).indexOf('[object Object]') > -1 || Array.isArray(value2[value3])) {\n        if (typeof value2[value3].epoch_time != 'undefined') {\n          var date = new Date(value2[value3].epoch_time*1000);\n          table_html += '<td>'+date+'</td>';\n        } else {\n          table_html += '<td>'+JSON.stringify(value2[value3]).replace(/:\"/g, ': \"').replace(/,/g, ', ')+'</td>';\n        }\n      } else if (value3 in value2) {\n        table_html += '<td>'+value2[value3]+'</td>';\n      }\n        return table_html;\n    }\n    if(typeof console === \"undefined\"){\n    console = { log: function() { } };\n  }\n  function highlight(what, where) {\n    try {  \n    where.each(function() {\n      $(this).html($(this).html().replace(what.not('photo'), '<span class=\"highlight\">'+what+'</span>'));\n    });\n    } catch (err) {\n        \n    }\n  }\nfunction clone(obj) {\n    if (null == obj || \"object\" != typeof obj) return obj;\n    var copy = obj.constructor();\n    for (var attr in obj) {\n        if (obj.hasOwnProperty(attr)) copy[attr] = clone(obj[attr]);\n    }\n    return copy;\n}\nfunction stringStartsWith (string, prefix) {\n  return string.slice(0, prefix.length) == prefix;\n}\nfunction appendLater(what, when) {\n  setTimeout(function() {$('.data_results').append(what)}, when);   \n}\nfunction addData(table, element, data, page) {\n  element.html('');\n  window.payload = data['payload'];\n  //console.log(window.payload);  \n  //console.log('fields '+data['fields']);\n  var additional = '';\n  if ('has_string_in_any_field' in window.payload) {\n    additional = ' mentioning \"'+window.payload['has_string_in_any_field']+'\"';\n    setTimeout(function() {highlight(window.payload['has_string_in_any_field'], $('.data_results td'))}, 1500);\n  }\n  var title = data['table']['name']+additional;\n  var header = '<section class=\"content-header\"><h1>'+title+'</h1></section>';\n  element.append(header);\n  header = '';\n  document.title = title + \" | Inside Your Government\";\n  header = '<section class=\"content\"><a href=\"#!/data/?table='+data['table']['id']+'\">Link to table without any subqueries</a> ';\n  header += 'Raw data in JSON format at <span class=\"url\"></span>';\n  header += '<br/><strong>Search:</strong> <input type=\"text\" class=\"search_query\" /><input type=\"button\" data-table=\"'+data['table']['id']+'\" class=\"go\" value=\"go\" />';\n  if (data['number_of_rows'] == 1) {\n    header += ' ('+data['number_of_rows']+' row)';\n  } else {\n    header += ' ('+data['number_of_rows']+' '+data['name_for_rows']+')';\n  }\n  $.each(data['field_selectors'], function(i, value) {\n    if (value['selector'] == 'checkbox') {\n        var isboth = '';\n        var istrue = '';  \n        var isfalse = '';   \n        if ('filter' in window.payload) {\n          if (value['name'] in window.payload['filter']) {\n\n            switch(window.payload['filter'][value['name']]) {\n              case true:\n                  istrue = ' selected';\n                  break;\n              case false:\n                  isfalse = ' selected';\n                  break;\n            }        \n          }\n          else {\n            isboth = ' selected';\n          }\n        } else {\n          isboth = ' selected';\n        }\n\n        header += ' <select data-field=\"'+value['name']+'\" class=\"boolean_field\"><option value=\"both\"'+isboth+'>Both '+value['display_name']+' and Not '+value['display_name']+'</option><option value=\"true\"'+istrue+'>Only '+value['display_name']+'</option><option value=\"false\"'+isfalse+'>Only Not '+value['display_name']+'</option></select>';\n    } else if (value['selector'] == 'dropdown') {\n        header += ' <strong>'+value['display_name']+'</strong> <select data-field=\"'+value['name']+'\" class=\"dropdown_selector\">';\n        \n        selected = 'none';\n        if ('filter' in window.payload) {\n          if (value['name'] in window.payload['filter']) {\n            selected = window.payload[value['name']];\n          }\n        }\n        $.each(value['items'], function(items_i, item) {\n            if (item == selected) {\n                selected_html = ' selected';\n            } else {\n              selected_html = '';   \n            }\n            header += '<option value=\"'+item+'\"'+selected_html+'>'+item+'</option>';\n        });\n        if (selected == 'none') {\n            if ('none' == selected) {\n              selected_html = ' selected';\n            } else {\n              selected_html = '';   \n            }\n        }\n        header += '<option value=\"none\"'+selected_html+'></option>';\n        header += '</select>';\n    }\n  });\n  header += '<br/><strong>Sorting:</strong> ';\n  header += ' <strong>Field:</strong> ';\n  header += '<select class=\"field_for_sorting\">';\n  header += '<option value=\"\" selected></option>';\n  $.each(data['fields'], function(i, value) {\n    header += '<option value=\"'+value+'\">'+value+'</option>';\n  });\n  header += '</select>';\n  header += ' <strong>Direction:</strong> ';\n  header += '<select class=\"direction_for_sorting\">';\n  header += '<option value=\"desc\" selected>descending</option>';\n  header += '<option value=\"asc\">ascending</option>';   \n  header += '</select>';\n  if ('percentages' in data) {\n    if (data['percentages'].length > 0) {\n      header += '<h3>Auto generated analysis</h3>';\n      header += '<table class=\"data_table percentages\"><tr><th>Field</th><th>Value</th><th>Percentage</th><th>Sentence</th></tr>';\n      \n      $.each(data['percentages'], function(i, value) {\n        new_payload = clone(window.payload);\n        new_payload['filter'] = {};\n        new_payload['filter'][value['field']] = true;\n        header += '<tr><td>'+value['field']+'</td><td><a href=\"/#!/data/?payload='+encodeURIComponent(JSON.stringify(new_payload))+'\">'+value['value']+'</a></td><td>'+value['percentage']+'</td><td>'+value['sentence']+'</tr>';\n      });\n      header += '</table>';\n    }\n  }\n  header += '<h3>Rankings</h3>';\n  $.each(data['group_counts'], function(j, value2) {\n      header += '<table class=\"data_table\"><tr><th colspan=\"2\">'+value2[0]+'</th></tr>';\n      $.each(value2[1], function(h, value3) {\n          header += '<tr><td>'+JSON.stringify(value3[0])+'</td><td>'+value3[1]+'</td></tr>';\n      });\n      header += '</table>';\n  });\n  header += '<h3>The data</h3>';\n  header += '<div class=\"pages\"></div>';\n  //element.append(header);\n  //header = '';\n  \n  var table_html = '<table class=\"data_table data_results\"></table><div class=\"pages\"></div></section>';\n  element.append(header+table_html);\n  table_html = '';\n  if (page * per_page < number_of_records) {\n      var rows = data['data'].slice((page-1) * per_page,page * per_page);\n  } else {\n      var rows = data['data'].slice((page-1) * per_page);\n  }\n  $.each(rows, function(j, value2) {\n    table_html += '<tr>';\n    \n    if ('default_fields_to_display' in data['table']) {\n      var fields = data['table']['default_fields_to_display'];\n    } else {\n      var fields = data['fields'];\n    }\n    $.each(fields, function(i, value) {\n      table_html += '<th>'+value+'</th>';\n    });\n    table_html += '</tr>';\n    table_html += '<tr>';\n    $.each(fields, function(h, value3) {\n      table_html += cell(value2, value3); \n    });\n    table_html += '</tr>';\n    //appendLater(table_html, j*5)\n    //$('.data_results').append(table_html);\n    //console.log(table_html);\n  });\n  \n  //table_html += '</table>';\n  setTimeout(function() {$('.data_results').html(table_html);}, 1000);\n    var number_of_records = data['number_of_rows'];\n    var per_page = 10\n    var pages = Math.floor(number_of_records / per_page);\n    if (pages > 1) {\n        if (number_of_records % per_page != 0) {\n            pages += 1;\n        }\n        if (pages+1 < 20) {\n          var end = pages + 1;\n        } else {\n          var end = 20;   \n        }\n        for (var i=1;i<end;i++) {\n            $('.pages').append('<a href=\"\" class=\"to_page_'+i+'\">'+i+'</a>');\n            //console.log(i+' '+pages);\n            if (i != pages) {\n              $('.pages').append(' | ');\n            }\n        }\n    }\n}\nfunction addUrl(element, url) {\n  window.location.hash = '!/data/'+url.substring(45);\n  //console.log('add url '+url);\n  setTimeout(function() {element.find('.url').html('<a href=\"'+url+'\">'+url+'</a>');}, 500);\n}\nfunction getData(table, element, other) {\n  element.text('Loading the data');\n  var params = {'table': table};\n  if (other) {\n    var params = other;\n    params['table'] = table;\n  }\n  $.ajax({\n      url: 'https://api.insideyourgovernment.com/retrive/',\n      data: {'payload': JSON.stringify(params)},\n      dataType: 'json',\n      complete : function(){\n        //console.log('url', this.url);\n          addUrl(element, this.url);\n      },\n      success: function(data){\n        window.data = data;\n        addData(table, element, window.data, 1);\n      }\n  });\n}\nfunction getDataForPayload(payload, element) {\n    element.text('Loading the data');\n  //console.log('type '+String(payload) == '[object Object]');\n  if (String(payload) == '[object Object]') {\n    $.ajax({\n        url: 'https://api.insideyourgovernment.com/retrive/',\n        data: {'payload': JSON.stringify(window.payload)},\n        dataType: 'json',\n        complete : function(){\n          //console.log('url', this.url);\n            addUrl(element, this.url);\n        },\n        success: function(data){\n          var table = data['table'];\n          window.data = data;\n          addData(table, element, data, 1);\n          if ('payload' in data) {\n            if ('has_string_in_any_field' in data['payload']) {\n              setTimeout(function() {$('.search_query').val(data['payload']['has_string_in_any_field'])}, 1000);\n            }\n          }\n        }\n    });\n    \n  } else {\n    \n    $.ajax({\n        url: 'https://api.insideyourgovernment.com/retrive/?payload='+payload,\n        \n        dataType: 'json',\n        complete : function(){\n          //console.log('url', this.url);\n            addUrl(element, this.url);\n        },\n        success: function(data){\n          window.data = data;\n          var table = data['table'];\n          addData(table, element, data, 1);\n          if ('payload' in data) {\n            if ('has_string_in_any_field' in data['payload']) {\n              setTimeout(function() {$('.search_query').val(data['payload']['has_string_in_any_field'])}, 500);\n            }\n          }\n        }\n    });\n  }\n}\nString.prototype.endsWith = function(suffix) {\n  return this.indexOf(suffix, this.length - suffix.length) !== -1;\n};\nfunction processHash() {\n  setTimeout(function() {\n    $('#share_buttons #facebook').html(\"<div class=\\\"fb-share-button\\\" data-href=\\\"\"+window.location+\" data-layout=\\\"button\\\"><\\/div>\");\n    $('#share_buttons #twitter').html(\"<a href=\\\"https:\\/\\/twitter.com\\/share\\\" class=\\\"twitter-share-button\\\"{count} data-size=\\\"large\\\">Tweet<\\/a>\\r\\n<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=\\/^http:\\/.test(d.location)?\\'http\\':\\'https\\';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+\\':\\/\\/platform.twitter.com\\/widgets.js\\';fjs.parentNode.insertBefore(js,fjs);}}(document, \\'script\\', \\'twitter-wjs\\');<\\/script>\");\n  }, 1000);\n  var hash = window.location.hash;\n  if (hash) {\n    if (hash.endsWith('/')) {\n      hash = hash.slice(3,-1);\n    } else {\n      hash = hash.slice(3);         \n    }\n    //console.log(hash);\n    $('.main').hide();\n    $('#nav a').removeClass('current');\n    $(\"[href='/#!/\"+hash+\"/']\").addClass('current');\n    //console.log('substring '+hash.substring(0, 11));\n    $('#working_space').text('');\n    if (hash.substring(0, 9) == 'articles/') {\n        //console.log('next substring '+hash.substring(9));\n        $('#'+hash.substring(9)+'_article').show();\n        document.title = $('#'+hash.substring(9)+'_article h2').text() + ' | Inside Your Government';\n        gaTrack(window.location.hash.substring(2), document.title + ' | Inside Your Government');\n        DISQUS.reset({\n          reload: true,\n          config: function () {  \n            this.page.identifier = hash.substring(9);  \n            this.page.url = window.location;\n          }\n        });\n    } else if (hash.substring(0, 12) == 'data/?table=') {\n        var table = hash.substring(12);\n        //console.log(table);\n        getData(table, $('#working_space'));\n        DISQUS.reset({\n          reload: true,\n          config: function () {  \n            this.page.identifier = hash.substring(9);  \n            this.page.url = window.location;\n          }\n        });\n    } else if (hash.substring(0, 14) == 'data/?payload=') {\n        var payload = hash.substring(14);\n        //console.log(table);\n        getDataForPayload(payload, $('#working_space'));\n        setTimeout(function() {DISQUS.reset({\n          reload: true,\n          config: function () {  \n            this.page.identifier = hash.substring(9);  \n            this.page.url = window.location;\n          }\n        })}, 1000);\n    } else {\n        \n        document.title = $('#'+hash+'_main h1').text() + ' | Inside Your Government';\n        gaTrack(window.location.hash.substring(2), document.title + ' | Inside Your Government');\n        $('#'+hash+'_main').show();\n        \n    }    \n    \n  } else {\n    window.location.hash = '#!/home/';\n    processHash();\n  }\n}\n\nfunction getCookie(cname) {\n    var name = cname + \"=\";\n    var ca = document.cookie.split(';');\n    for(var i=0; i<ca.length; i++) {\n        var c = ca[i];\n        while (c.charAt(0)==' ') c = c.substring(1);\n        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);\n    }\n    return \"\";\n}\n\n// Function to load and initiate the Analytics tracker\nfunction gaTracker(id){\n  $.getScript('//www.google-analytics.com/analytics.js'); // jQuery shortcut\n  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;\n  ga('create', id, 'auto');\n  ga('send', 'pageview');\n}\n\n\n// Function to track a virtual page view\nfunction gaTrack(path, title) {\n  ga('set', { page: path, title: title });\n  ga('send', 'pageview');\n}\n\n\n$(function() {\n  $('#nav').height($('#nav a:link').outerHeight()+2);\n  gaTracker('UA-70789642-1');\n  $('#account_box').hide();\n  $('.main').not('#home').hide();\n  processHash();\n  //$('ul'+hash+':first').show();\n  $('body').on('click', 'a', function() {\n    //console.log($(this).attr('href').substring(0, 1));\n    if ($(this).attr('href').substring(0, 3) == \"/#!\" || $(this).attr('href').substring(0, 2) == \"#!\") {\n      setTimeout(function(){processHash();},100);\n    }\n  });\n  //console.log(document.cookie);\n  //console.log(getCookie('session'));\n  $.get('https://api.insideyourgovernment.com/get_session_info/', {'session': getCookie('session')}, function(data) {\n      //console.log(data);\n      $('#login_box').hide();\n      $('#account_box').show(); \n      if (data['is_admin']) {\n        $('.admin').show();\n        $.get('https://api.insideyourgovernment.com/tables/', function(data) {\n           $.each(data, function(i, value) {\n             $('#tables_for_action').append('<option value=\"'+value+'\">'+value+'</option>');\n           });           \n        });\n      }\n    }); \n  $('#login').click(function() {\n    $.post('https://api.insideyourgovernment.com/login/', {'email': $('#email').val(), 'password': $('#password').val()}, function(data) {\n        //console.log(typeof data);\n        //console.log(data['session_id']);\n      document.cookie=\"session=\"+data['session_id'];\n      //console.log(document.cookie);\n      //console.log(data);  \n    });  \n  });\n  $.fn.getAttributes = function() {\n    var attributes = {}; \n    if( this.length ) {\n        $.each( this[0].attributes, function( index, attr ) {\n            if (attr.name.substring(0,5) == 'data-') {\n              if (attr.name == 'data-pluck') {\n                attributes[ attr.name.slice(5) ] = JSON.parse(attr.value);\n              } else {\n                attributes[ attr.name.slice(5) ] = attr.value;\n              }\n            } else {\n              attributes[ attr.name ] = attr.value;\n            }\n        } ); \n    }\n    return attributes;\n  };\n  function addDivsOfTables(theObj, data) {\n    //theObj.html(JSON.stringify(data));\n    $.each(data['keys'], function(i, value) {\n      var table = '<table class=\"data_table\">';\n      table += '<tr><th>Link</th>';\n      $.each(data['table_fields'], function(j, value2) {\n        table += '<th>'+value2+'</th>';\n      });\n      //console.log(value+' '+JSON.stringify(data[value]));\n      $.each(data['data'][value], function(j, value2) {\n        table += '<tr>';\n        table += '<td><a href=\"/#!/data/?table='+value2[theObj.attr('data-field_for_url')]+'\">'+value2[theObj.attr('data-field_to_name_link')]+'</a>';\n        $.each(data['table_fields'], function(h, value3) {\n          table += cell(value2, value3);\n        });\n        table += '</tr>';\n      });\n      table += '</tr>';\n      table += '</table>';\n      theObj.append('<div class=\"box_200\"><h3>'+value+'</h3>'+table+'</div>');\n    });\n  }\n  function getDivsOfTables(theObj) {\n    var params = theObj.getAttributes();\n    //console.log('https://api.insideyourgovernment.com/retrive/?payload='+encodeURIComponent(JSON.stringify(params)))\n    $.get('https://api.insideyourgovernment.com/retrive/', {'payload': JSON.stringify(params)}, function(data) {\n      //console.log(data);\n        \n      addDivsOfTables(theObj, data);\n    });\n  }\n  $('.divs_of_tables').each(function() {\n    getDivsOfTables($(this));\n  });\n\n  $('body').on('click', '.go', function() {\n    var query = $(this).prev().val();\n    getData($(this).attr('data-table'), $('#working_space'), {'has_string_in_any_field': query});\n    setTimeout(function() {$('.search_query').val(query)}, 1000);\n    setTimeout(function() {highlight($('.search_query').val(), $('#working_space td').not('.photo'))}, 1000);\n  });\n  $(\"body\").on('keyup', '.search_query', function (e) {\n    if (e.keyCode == 13) {\n        $(this).parent().find('.go').trigger('click');\n    }\n  });\n  $('body').on('change', '.boolean_field', function(e) {\n    var f = $(this).attr('data-field');\n    window.payload['filter'] = {};\n    //console.log(JSON.stringify(window.payload));\n    if ($(this).val() == 'both') {\n      if ('filter' in window.payload) {\n        if ($(this).attr('data-field') in window.payload['filter']) {\n          delete window.payload['filter'][$(this).attr('data-field')];\n        }\n        if (Object.keys(window.payload['filter'])) {\n          delete window.payload['filter'];\n        }\n      }      \n    } else {\n      //console.log($(this).val(), Boolean($(this).val()));\n      window.payload['filter'][f] = ($(this).val() == 'true');\n    }\n    getDataForPayload(window.payload, $('#working_space'));\n    \n  });\n  $('body').on('change', '.dropdown_selector', function(e) {\n    var f = $(this).attr('data-field');\n    window.payload['filter'] = {};\n    //console.log(JSON.stringify(window.payload));\n    if ($(this).val() == 'none') {\n      if ('filter' in window.payload) {\n        if ($(this).attr('data-field') in window.payload['filter']) {\n          delete window.payload['filter'][$(this).attr('data-field')];\n        }\n        //if (Object.keys(window.payload['filter'])) {\n        //  delete window.payload['filter'];\n        //}\n      }      \n    } else {\n      //console.log($(this).val(), Boolean($(this).val()));\n      window.payload['filter'][f] = $(this).val();\n    }\n    getDataForPayload(window.payload, $('#working_space'));\n    \n  }); \n   $('body').on('click', '.pages a', function(e) {\n        e.preventDefault();\n        $('.pages a').removeClass('current');\n        $('.to_page_'+$(this).text()).addClass('current');\n        window['page'] = parseInt($(this).text());\n        getDataForPayload(window.data, $('#working_space'));\n        //addData(window.data['table']['id'], $('#working_space'), window.data, $(this).text());\n   });\n});"
{"patch":[[[[0,"nd(h"],[-1,"eader+"],[0,"tabl"]],8340,8340,14,8]],"time":1450724206675}
{"patch":[[[[0,".append("],[-1,"h"],[0,"table_ht"]],8335,8335,17,16]],"time":1450724204712}
{"patch":[[[[0,"iv>';\n  "],[-1,"/"],[0,"/element"]],8167,8167,17,16]],"time":1450724194126}
{"patch":[[[[0,"iv>';\n  "],[-1,"/"],[0,"element."]],8167,8167,17,16]],"time":1450724192131}
{"patch":[[[[0,"  }\n  }\n"],[1,"  element.append(header);\n  header = '';\n"],[0,"  header"]],7733,7733,16,57]],"time":1450724114992}
{"patch":[[[[0,"']+')';\n  }\n"],[1,"  element.append(header);\n  header = '';\n"],[0,"  $.each(dat"]],4393,4393,24,65]],"time":1450724107367}
{"patch":[[[[0,"= '<"],[-1,"section class=\"content\"><"],[0,"a hr"]],3870,3870,33,8]],"time":1450723991133}
{"patch":[[[[0,"'</h1></section>"],[1,"<section class=\"content\">"],[0,"';\n  element.app"]],3745,3745,32,57]],"time":1450723985297}
{"patch":[[[[0,"></div><"],[-1,"/section>"],[0,"';\n  ele"]],8386,8386,25,16]],"time":1450723610955}
{"patch":[[[[0,"\"></div>"],[-1,"<"],[0,"';\n  ele"]],8385,8385,17,16]],"time":1450723608997}
{"patch":[[[[0,"content\""],[-1,">"],[0,"';\n  ele"]],3777,3777,17,16]],"time":1450723587822}
{"patch":[[[[0,"ass="],[-1,"\"content\""],[0,"';\n "]],3772,3772,17,8]],"time":1450723585767}
{"patch":[[[[0,"tion><se"],[-1,"ction class="],[0,"';\n  ele"]],3756,3756,28,16]],"time":1450723583767}
{"patch":[[[[0,"ection><"],[-1,"se"],[0,"';\n  ele"]],3754,3754,18,16]],"time":1450723581767}
{"patch":[[[[0,"section>"],[-1,"<"],[0,"';\n  ele"]],3753,3753,17,16]],"time":1450723579804}
{"patch":[[[[0,"</se"],[-1,"ction>"],[0,"';\n "]],3751,3751,14,8]],"time":1450723575420}
{"patch":[[[[0,"e+'</h1>"],[-1,"</se"],[0,"';\n  ele"]],3743,3743,20,16]],"time":1450723573417}
{"patch":[[[[0,"-header\""],[-1,">"],[0,"<h1>'+ti"]],3724,3724,17,16]],"time":1450723569419}
{"patch":[[[[0,"= '<"],[-1,"section class=\"content-header\"<"],[0,"h1>'"]],3698,3698,39,8]],"time":1450723567408}
{"patch":[[[[0,"'_main h"],[-1,"1"],[0,"').text("]],14839,14839,17,16]],"time":1450722399234}
{"patch":[[[[0,"'_main h"],[1,"2"],[0,"').text("]],14839,14839,16,17]],"time":1450722397234}
{"patch":[[[[0,"tle+'</h"],[-1,"1"],[0,">';\n  el"]],3709,3709,17,16]],"time":1450722374978}
{"patch":[[[[0,"tle+'</h"],[1,"2"],[0,">';\n  el"]],3709,3709,16,17]],"time":1450722372977}
{"patch":[[[[0,"er = '<h"],[-1,"1"],[0,">'+title"]],3695,3695,17,16]],"time":1450722370977}
{"patch":[[[[0,"der = '<"],[-1,"h"],[0,">'+title"]],3694,3694,17,16]],"time":1450722368979}
{"patch":[[[[0,"der = '<"],[1,"h2"],[0,">'+title"]],3694,3694,16,18]],"time":1450722366985}
{"patch":[[[[-1,"    function numberWithCommas(x) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n    function cell(value2, value3) {\n        table_html = '';\nif (!(value3 in value2)) {\n        table_html += '<td></td>';\n      } else if (value3.indexOf(\"photo\") > -1) {\n        table_html += '<td class=\"photo\"><img src=\"'+value2[value3]+'\" style=\"max-width:100px\" /></td>';\n      } else if (value2[value3] === parseInt(value2[value3], 10)) {\n        table_html += '<td>'+numberWithCommas(value2[value3])+'</td>';\n      } else if (value3 == 'links') {\n        table_html += '<td><ul>';\n        $.each(value2[value3], function(linki, link) {\n          table_html += '<li><a href=\"'+link['url']+'\">'+link['name']+'</a></li>';\n        });\n        table_html += '</ul></td>';\n      } else if (value3.indexOf('link') > -1) {\n        table_html += '<td><a href=\"'+value2[value3]+'\">'+value2[value3]+'</a></td>';\n      } else if (value3 == 'Summarized results') {\n        var sresults = value2[value3];\n        table_html += '<td><table>';\n        $.each(sresults, function(eindex, employee) {\n          table_html += '<tr><th colspan=\"2\">'+employee['heading']+'</th></tr>';\n          $.each(employee['allegations'], function(aindex, allegation) {\n            table_html += '<tr><th>'+allegation['heading']+'</th><td>'+allegation['allegation']+'</td></tr>';\n            if (stringStartsWith(allegation['opa_finding'], 'Sustained')) {\n              highlighting = ' class=\"highlight\"';\n            } else {\n              highlighting = '';\n            }\n            table_html += '<tr><th>'+allegation['heading']+' OPA finding</th><td'+highlighting+'>'+allegation['opa_finding']+'</td></tr>';\n          });\n          table_html += '<tr><th>Final discipline</th><td>'+employee['final_discipline']+'</td></tr>';\n        });\n        table_html += '</table>';\n        table_html += '</td>';\n      } else if (String(value2[value3]).indexOf('[object Object]') > -1 || Array.isArray(value2[value3])) {\n        if (typeof value2[value3].epoch_time != 'undefined') {\n          var date = new Date(value2[value3].epoch_time*1000);\n          table_html += '<td>'+date+'</td>';\n        } else {\n          table_html += '<td>'+JSON.stringify(value2[value3]).replace(/:\"/g, ': \"').replace(/,/g, ', ')+'</td>';\n        }\n      } else if (value3 in value2) {\n        table_html += '<td>'+value2[value3]+'</td>';\n      }\n        return table_html;\n    }\n    if(typeof console === \"undefined\"){\n    console = { log: function() { } };\n  }\n  function highlight(what, where) {\n    try {  \n    where.each(function() {\n      $(this).html($(this).html().replace(what.not('photo'), '<span class=\"highlight\">'+what+'</span>'));\n    });\n    } catch (err) {\n        \n    }\n  }\nfunction clone(obj) {\n    if (null == obj || \"object\" != typeof obj) return obj;\n    var copy = obj.constructor();\n    for (var attr in obj) {\n        if (obj.hasOwnProperty(attr)) copy[attr] = clone(obj[attr]);\n    }\n    return copy;\n}\nfunction stringStartsWith (string, prefix) {\n  return string.slice(0, prefix.length) == prefix;\n}\nfunction appendLater(what, when) {\n  setTimeout(function() {$('.data_results').append(what)}, when);   \n}\nfunction addData(table, element, data, page) {\n  element.html('');\n  window.payload = data['payload'];\n  //console.log(window.payload);  \n  //console.log('fields '+data['fields']);\n  var additional = '';\n  if ('has_string_in_any_field' in window.payload) {\n    additional = ' mentioning \"'+window.payload['has_string_in_any_field']+'\"';\n    setTimeout(function() {highlight(window.payload['has_string_in_any_field'], $('.data_results td'))}, 1500);\n  }\n  var title = data['table']['name']+additional;\n  var header = '<h2>'+title+'</h2>';\n  element.append(header);\n  header = '';\n  document.title = title + \" | Inside Your Government\";\n  header = '<a href=\"#!/data/?table='+data['table']['id']+'\">Link to table without any subqueries</a> ';\n  header += 'Raw data in JSON format at <span class=\"url\"></span>';\n  header += '<br/><strong>Search:</strong> <input type=\"text\" class=\"search_query\" /><input type=\"button\" data-table=\"'+data['table']['id']+'\" class=\"go\" value=\"go\" />';\n  if (data['number_of_rows'] == 1) {\n    header += ' ('+data['number_of_rows']+' row)';\n  } else {\n    header += ' ('+data['number_of_rows']+' '+data['name_for_rows']+')';\n  }\n  element.append(header);\n  header = '';\n  $.each(data['field_selectors'], function(i, value) {\n    if (value['selector'] == 'checkbox') {\n        var isboth = '';\n        var istrue = '';  \n        var isfalse = '';   \n        if ('filter' in window.payload) {\n          if (value['name'] in window.payload['filter']) {\n\n            switch(window.payload['filter'][value['name']]) {\n              case true:\n                  istrue = ' selected';\n                  break;\n              case false:\n                  isfalse = ' selected';\n                  break;\n            }        \n          }\n          else {\n            isboth = ' selected';\n          }\n        } else {\n          isboth = ' selected';\n        }\n\n        header += ' <select data-field=\"'+value['name']+'\" class=\"boolean_field\"><option value=\"both\"'+isboth+'>Both '+value['display_name']+' and Not '+value['display_name']+'</option><option value=\"true\"'+istrue+'>Only '+value['display_name']+'</option><option value=\"false\"'+isfalse+'>Only Not '+value['display_name']+'</option></select>';\n    } else if (value['selector'] == 'dropdown') {\n        header += ' <strong>'+value['display_name']+'</strong> <select data-field=\"'+value['name']+'\" class=\"dropdown_selector\">';\n        \n        selected = 'none';\n        if ('filter' in window.payload) {\n          if (value['name'] in window.payload['filter']) {\n            selected = window.payload[value['name']];\n          }\n        }\n        $.each(value['items'], function(items_i, item) {\n            if (item == selected) {\n                selected_html = ' selected';\n            } else {\n              selected_html = '';   \n            }\n            header += '<option value=\"'+item+'\"'+selected_html+'>'+item+'</option>';\n        });\n        if (selected == 'none') {\n            if ('none' == selected) {\n              selected_html = ' selected';\n            } else {\n              selected_html = '';   \n            }\n        }\n        header += '<option value=\"none\"'+selected_html+'></option>';\n        header += '</select>';\n    }\n  });\n  header += '<br/><strong>Sorting:</strong> ';\n  header += ' <strong>Field:</strong> ';\n  header += '<select class=\"field_for_sorting\">';\n  header += '<option value=\"\" selected></option>';\n  $.each(data['fields'], function(i, value) {\n    header += '<option value=\"'+value+'\">'+value+'</option>';\n  });\n  header += '</select>';\n  header += ' <strong>Direction:</strong> ';\n  header += '<select class=\"direction_for_sorting\">';\n  header += '<option value=\"desc\" selected>descending</option>';\n  header += '<option value=\"asc\">ascending</option>';   \n  header += '</select>';\n  if ('percentages' in data) {\n    if (data['percentages'].length > 0) {\n      header += '<h3>Auto generated analysis</h3>';\n      header += '<table class=\"data_table percentages\"><tr><th>Field</th><th>Value</th><th>Percentage</th><th>Sentence</th></tr>';\n      \n      $.each(data['percentages'], function(i, value) {\n        new_payload = clone(window.payload);\n        new_payload['filter'] = {};\n        new_payload['filter'][value['field']] = true;\n        header += '<tr><td>'+value['field']+'</td><td><a href=\"/#!/data/?payload='+encodeURIComponent(JSON.stringify(new_payload))+'\">'+value['value']+'</a></td><td>'+value['percentage']+'</td><td>'+value['sentence']+'</tr>';\n      });\n      header += '</table>';\n    }\n  }\n  element.append(header);\n  header = '';\n  header += '<h3>Rankings</h3>';\n  $.each(data['group_counts'], function(j, value2) {\n      header += '<table class=\"data_table\"><tr><th colspan=\"2\">'+value2[0]+'</th></tr>';\n      $.each(value2[1], function(h, value3) {\n          header += '<tr><td>'+JSON.stringify(value3[0])+'</td><td>'+value3[1]+'</td></tr>';\n      });\n      header += '</table>';\n  });\n  header += '<h3>The data</h3>';\n  header += '<div class=\"pages\"></div>';\n  element.append(header);\n  //header = '';\n  \n  var table_html = '<table class=\"data_table data_results\"></table><div class=\"pages\"></div>';\n  element.append(table_html);\n  table_html = '';\n  if (page * per_page < number_of_records) {\n      var rows = data['data'].slice((page-1) * per_page,page * per_page);\n  } else {\n      var rows = data['data'].slice((page-1) * per_page);\n  }\n  $.each(rows, function(j, value2) {\n    table_html += '<tr>';\n    \n    if ('default_fields_to_display' in data['table']) {\n      var fields = data['table']['default_fields_to_display'];\n    } else {\n      var fields = data['fields'];\n    }\n    $.each(fields, function(i, value) {\n      table_html += '<th>'+value+'</th>';\n    });\n    table_html += '</tr>';\n    table_html += '<tr>';\n    $.each(fields, function(h, value3) {\n      table_html += cell(value2, value3); \n    });\n    table_html += '</tr>';\n    //appendLater(table_html, j*5)\n    //$('.data_results').append(table_html);\n    //console.log(table_html);\n  });\n  \n  //table_html += '</table>';\n  setTimeout(function() {$('.data_results').html(table_html);}, 1000);\n    var number_of_records = data['number_of_rows'];\n    var per_page = 10\n    var pages = Math.floor(number_of_records / per_page);\n    if (pages > 1) {\n        if (number_of_records % per_page != 0) {\n            pages += 1;\n        }\n        if (pages+1 < 20) {\n          var end = pages + 1;\n        } else {\n          var end = 20;   \n        }\n        for (var i=1;i<end;i++) {\n            $('.pages').append('<a href=\"\" class=\"to_page_'+i+'\">'+i+'</a>');\n            //console.log(i+' '+pages);\n            if (i != pages) {\n              $('.pages').append(' | ');\n            }\n        }\n    }\n}\nfunction addUrl(element, url) {\n  window.location.hash = '!/data/'+url.substring(45);\n  //console.log('add url '+url);\n  setTimeout(function() {element.find('.url').html('<a href=\"'+url+'\">'+url+'</a>');}, 500);\n}\nfunction getData(table, element, other) {\n  element.text('Loading the data');\n  var params = {'table': table};\n  if (other) {\n    var params = other;\n    params['table'] = table;\n  }\n  $.ajax({\n      url: 'https://api.insideyourgovernment.com/retrive/',\n      data: {'payload': JSON.stringify(params)},\n      dataType: 'json',\n      complete : function(){\n        //console.log('url', this.url);\n          addUrl(element, this.url);\n      },\n      success: function(data){\n        window.data = data;\n        addData(table, element, window.data, 1);\n      }\n  });\n}\nfunction getDataForPayload(payload, element) {\n    element.text('Loading the data');\n  //console.log('type '+String(payload) == '[object Object]');\n  if (String(payload) == '[object Object]') {\n    $.ajax({\n        url: 'https://api.insideyourgovernment.com/retrive/',\n        data: {'payload': JSON.stringify(window.payload)},\n        dataType: 'json',\n        complete : function(){\n          //console.log('url', this.url);\n            addUrl(element, this.url);\n        },\n        success: function(data){\n          var table = data['table'];\n          window.data = data;\n          addData(table, element, data, 1);\n          if ('payload' in data) {\n            if ('has_string_in_any_field' in data['payload']) {\n              setTimeout(function() {$('.search_query').val(data['payload']['has_string_in_any_field'])}, 1000);\n            }\n          }\n        }\n    });\n    \n  } else {\n    \n    $.ajax({\n        url: 'https://api.insideyourgovernment.com/retrive/?payload='+payload,\n        \n        dataType: 'json',\n        complete : function(){\n          //console.log('url', this.url);\n            addUrl(element, this.url);\n        },\n        success: function(data){\n          window.data = data;\n          var table = data['table'];\n          addData(table, element, data, 1);\n          if ('payload' in data) {\n            if ('has_string_in_any_field' in data['payload']) {\n              setTimeout(function() {$('.search_query').val(data['payload']['has_string_in_any_field'])}, 500);\n            }\n          }\n        }\n    });\n  }\n}\nString.prototype.endsWith = function(suffix) {\n  return this.indexOf(suffix, this.length - suffix.length) !== -1;\n};\nfunction processHash() {\n  setTimeout(function() {\n    $('#share_buttons #facebook').html(\"<div class=\\\"fb-share-button\\\" data-href=\\\"\"+window.location+\" data-layout=\\\"button\\\"><\\/div>\");\n    $('#share_buttons #twitter').html(\"<a href=\\\"https:\\/\\/twitter.com\\/share\\\" class=\\\"twitter-share-button\\\"{count} data-size=\\\"large\\\">Tweet<\\/a>\\r\\n<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=\\/^http:\\/.test(d.location)?\\'http\\':\\'https\\';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+\\':\\/\\/platform.twitter.com\\/widgets.js\\';fjs.parentNode.insertBefore(js,fjs);}}(document, \\'script\\', \\'twitter-wjs\\');<\\/script>\");\n  }, 1000);\n  var hash = window.location.hash;\n  if (hash) {\n    if (hash.endsWith('/')) {\n      hash = hash.slice(3,-1);\n    } else {\n      hash = hash.slice(3);         \n    }\n    //console.log(hash);\n    $('.main').hide();\n    $('#nav a').removeClass('current');\n    $(\"[href='/#!/\"+hash+\"/']\").addClass('current');\n    //console.log('substring '+hash.substring(0, 11));\n    $('#working_space').text('');\n    if (hash.substring(0, 9) == 'articles/') {\n        //console.log('next substring '+hash.substring(9));\n        $('#'+hash.substring(9)+'_article').show();\n        document.title = $('#'+hash.substring(9)+'_article h2').text() + ' | Inside Your Government';\n        gaTrack(window.location.hash.substring(2), document.title + ' | Inside Your Government');\n        DISQUS.reset({\n          reload: true,\n          config: function () {  \n            this.page.identifier = hash.substring(9);  \n            this.page.url = window.location;\n          }\n        });\n    } else if (hash.substring(0, 12) == 'data/?table=') {\n        var table = hash.substring(12);\n        //console.log(table);\n        getData(table, $('#working_space'));\n        DISQUS.reset({\n          reload: true,\n          config: function () {  \n            this.page.identifier = hash.substring(9);  \n            this.page.url = window.location;\n          }\n        });\n    } else if (hash.substring(0, 14) == 'data/?payload=') {\n        var payload = hash.substring(14);\n        //console.log(table);\n        getDataForPayload(payload, $('#working_space'));\n        setTimeout(function() {DISQUS.reset({\n          reload: true,\n          config: function () {  \n            this.page.identifier = hash.substring(9);  \n            this.page.url = window.location;\n          }\n        })}, 1000);\n    } else {\n        \n        document.title = $('#'+hash+'_main h2').text() + ' | Inside Your Government';\n        gaTrack(window.location.hash.substring(2), document.title + ' | Inside Your Government');\n        $('#'+hash+'_main').show();\n        \n    }    \n    \n  } else {\n    window.location.hash = '#!/home/';\n    processHash();\n  }\n}\n\nfunction getCookie(cname) {\n    var name = cname + \"=\";\n    var ca = document.cookie.split(';');\n    for(var i=0; i<ca.length; i++) {\n        var c = ca[i];\n        while (c.charAt(0)==' ') c = c.substring(1);\n        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);\n    }\n    return \"\";\n}\n\n// Function to load and initiate the Analytics tracker\nfunction gaTracker(id){\n  $.getScript('//www.google-analytics.com/analytics.js'); // jQuery shortcut\n  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;\n  ga('create', id, 'auto');\n  ga('send', 'pageview');\n}\n\n\n// Function to track a virtual page view\nfunction gaTrack(path, title) {\n  ga('set', { page: path, title: title });\n  ga('send', 'pageview');\n}\n\n\n$(function() {\n  $('#nav').height($('#nav a:link').outerHeight()+2);\n  gaTracker('UA-70789642-1');\n  $('#account_box').hide();\n  $('.main').not('#home').hide();\n  processHash();\n  //$('ul'+hash+':first').show();\n  $('body').on('click', 'a', function() {\n    //console.log($(this).attr('href').substring(0, 1));\n    if ($(this).attr('href').substring(0, 3) == \"/#!\" || $(this).attr('href').substring(0, 2) == \"#!\") {\n      setTimeout(function(){processHash();},100);\n    }\n  });\n  //console.log(document.cookie);\n  //console.log(getCookie('session'));\n  $.get('https://api.insideyourgovernment.com/get_session_info/', {'session': getCookie('session')}, function(data) {\n      //console.log(data);\n      $('#login_box').hide();\n      $('#account_box').show(); \n      if (data['is_admin']) {\n        $('.admin').show();\n        $.get('https://api.insideyourgovernment.com/tables/', function(data) {\n           $.each(data, function(i, value) {\n             $('#tables_for_action').append('<option value=\"'+value+'\">'+value+'</option>');\n           });           \n        });\n      }\n    }); \n  $('#login').click(function() {\n    $.post('https://api.insideyourgovernment.com/login/', {'email': $('#email').val(), 'password': $('#password').val()}, function(data) {\n        //console.log(typeof data);\n        //console.log(data['session_id']);\n      document.cookie=\"session=\"+data['session_id'];\n      //console.log(document.cookie);\n      //console.log(data);  \n    });  \n  });\n  $.fn.getAttributes = function() {\n    var attributes = {}; \n    if( this.length ) {\n        $.each( this[0].attributes, function( index, attr ) {\n            if (attr.name.substring(0,5) == 'data-') {\n              if (attr.name == 'data-pluck') {\n                attributes[ attr.name.slice(5) ] = JSON.parse(attr.value);\n              } else {\n                attributes[ attr.name.slice(5) ] = attr.value;\n              }\n            } else {\n              attributes[ attr.name ] = attr.value;\n            }\n        } ); \n    }\n    return attributes;\n  };\n  function addDivsOfTables(theObj, data) {\n    //theObj.html(JSON.stringify(data));\n    $.each(data['keys'], function(i, value) {\n      var table = '<table class=\"data_table\">';\n      table += '<tr><th>Link</th>';\n      $.each(data['table_fields'], function(j, value2) {\n        table += '<th>'+value2+'</th>';\n      });\n      //console.log(value+' '+JSON.stringify(data[value]));\n      $.each(data['data'][value], function(j, value2) {\n        table += '<tr>';\n        table += '<td><a href=\"/#!/data/?table='+value2[theObj.attr('data-field_for_url')]+'\">'+value2[theObj.attr('data-field_to_name_link')]+'</a>';\n        $.each(data['table_fields'], function(h, value3) {\n          table += cell(value2, value3);\n        });\n        table += '</tr>';\n      });\n      table += '</tr>';\n      table += '</table>';\n      theObj.append('<div class=\"box_200\"><h3>'+value+'</h3>'+table+'</div>');\n    });\n  }\n  function getDivsOfTables(theObj) {\n    var params = theObj.getAttributes();\n    //console.log('https://api.insideyourgovernment.com/retrive/?payload='+encodeURIComponent(JSON.stringify(params)))\n    $.get('https://api.insideyourgovernment.com/retrive/', {'payload': JSON.stringify(params)}, function(data) {\n      //console.log(data);\n        \n      addDivsOfTables(theObj, data);\n    });\n  }\n  $('.divs_of_tables').each(function() {\n    getDivsOfTables($(this));\n  });\n\n  $('body').on('click', '.go', function() {\n    var query = $(this).prev().val();\n    getData($(this).attr('data-table'), $('#working_space'), {'has_string_in_any_field': query});\n    setTimeout(function() {$('.search_query').val(query)}, 1000);\n    setTimeout(function() {highlight($('.search_query').val(), $('#working_space td').not('.photo'))}, 1000);\n  });\n  $(\"body\").on('keyup', '.search_query', function (e) {\n    if (e.keyCode == 13) {\n        $(this).parent().find('.go').trigger('click');\n    }\n  });\n  $('body').on('change', '.boolean_field', function(e) {\n    var f = $(this).attr('data-field');\n    window.payload['filter'] = {};\n    //console.log(JSON.stringify(window.payload));\n    if ($(this).val() == 'both') {\n      if ('filter' in window.payload) {\n        if ($(this).attr('data-field') in window.payload['filter']) {\n          delete window.payload['filter'][$(this).attr('data-field')];\n        }\n        if (Object.keys(window.payload['filter'])) {\n          delete window.payload['filter'];\n        }\n      }      \n    } else {\n      //console.log($(this).val(), Boolean($(this).val()));\n      window.payload['filter'][f] = ($(this).val() == 'true');\n    }\n    getDataForPayload(window.payload, $('#working_space'));\n    \n  });\n  $('body').on('change', '.dropdown_selector', function(e) {\n    var f = $(this).attr('data-field');\n    window.payload['filter'] = {};\n    //console.log(JSON.stringify(window.payload));\n    if ($(this).val() == 'none') {\n      if ('filter' in window.payload) {\n        if ($(this).attr('data-field') in window.payload['filter']) {\n          delete window.payload['filter'][$(this).attr('data-field')];\n        }\n        //if (Object.keys(window.payload['filter'])) {\n        //  delete window.payload['filter'];\n        //}\n      }      \n    } else {\n      //console.log($(this).val(), Boolean($(this).val()));\n      window.payload['filter'][f] = $(this).val();\n    }\n    getDataForPayload(window.payload, $('#working_space'));\n    \n  }); \n   $('body').on('click', '.pages a', function(e) {\n        e.preventDefault();\n        $('.pages a').removeClass('current');\n        $('.to_page_'+$(this).text()).addClass('current');\n        window['page'] = parseInt($(this).text());\n        getDataForPayload(window.data, $('#working_space'));\n        //addData(window.data['table']['id'], $('#working_space'), window.data, $(this).text());\n   });\n});"]],0,0,21688,0]],"time":1450534750715}